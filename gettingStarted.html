<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="== Prerequisites">
<title>Getting Started</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Getting Started</h1>
<div class="details">
<span id="author" class="author">== Prerequisites</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Kermoss Framework runs on Java 8 and above, and also uses the following direct dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring-boot version 2.2.4 and above</p>
</li>
<li>
<p>spring data jpa</p>
</li>
<li>
<p>spring kafka</p>
</li>
<li>
<p>spring cloud openfeign</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Regarding databases, kermoss is tested with oracle, postgresql and mysql</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_kermoss">Getting Kermoss</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be able to use kermoss in your project, add the following dependency in your pom.xml</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.kermoss&lt;/groupId&gt;
    &lt;artifactId&gt;reactive-business-flow&lt;/artifactId&gt;
    &lt;version&gt;${io.kermoss.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_kermoss_to_your_database">Connect kermoss to your database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kermoss uses <strong> Liquibase </strong> (an open source database change management tool) to manage the versioning of its database schema, if you already have liquibase in your project, you just have to add only this line to your db.changelog-master.xml file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;include file="db/changelog/db-kermoss-master.xml" relativeToChangelogFile="false"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your project does not include the <strong> liquibase </strong> tool, in this case add the following configuration in your pom.xml in the section menu:build[plugins]</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.liquibase&lt;/groupId&gt;
   &lt;artifactId&gt;liquibase-maven-plugin&lt;/artifactId&gt;
   &lt;configuration&gt;
	&lt;propertyFile&gt;src/main/resources/liquibase.properties&lt;/propertyFile&gt; <b class="conum">(1)</b>
	&lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>create the liquibase.properties file in the menu:src[main&gt;resources] location with the following elements:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">url=jdbc:postgresql://localhost:5432/pizzashop <b class="conum">(1)</b>
username=postgres <b class="conum">(2)</b>
password=mysecretpassword <b class="conum">(3)</b>
driver=org.postgresql.Driver <b class="conum">(4)</b>
changeLogFile=db/changelog/db.changelog-master.xml <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>for (1)-(2)-(3)-(4) change them with those of your own database .</p>
</div>
<div class="paragraph">
<p>for (5) create db.changelog-master.xml file in the menu:src[main&gt;resources&gt;db&gt;changelog] folder in your project with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"&gt;
    &lt;include file="db/changelog/db-kermoss-master.xml" relativeToChangelogFile="false"/&gt;
&lt;/databaseChangeLog&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>it&#8217;s almost finished, run the maven command to import the kermoss schema into your database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mvn process-resources liquibase:update</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Normally Kermoss should integrate into your project with your existing dataSource and transactionManager configuration with no worries.</p>
</div>
<div class="paragraph">
<p>If you have not yet configured your dataSource , put this configuration in your application.yml file, the database we took as an example is postgresql (oracle or mysql are also supported)</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spring.datasource:
  url: jdbc:postgresql://localhost:5432/pizzashop
  username: postgres
  password: mysecretpassword
  driver-class-name: org.postgresql.Driver
  hikari: <b class="conum">(1)</b>
    maximum-pool-size: 10


# Hibernate settings
spring.jpa.show-sql: true <b class="conum">(2)</b>
spring.jpa.properties.hibernate.dialect: org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.hbm2ddl.auto: validate <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>kermoss uses hikari pool by default, there is no restriction to choose for example tomcat or c3p0 as connection pool</p>
</li>
<li>
<p>For debugging sql queries .</p>
</li>
<li>
<p>We recommend setting this value to <strong> validate </strong> for the production environment</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_configuration_concepts">Basic configuration concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>this part indicates the first concepts to start kermoss within your project, it illustrates the basic and fundamental elements to configure your development or test environment.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kermoss: <b class="conum">(1)</b>
  service-name: pizza-shop <b class="conum">(2)</b>
  transport:
    default-layer: http <b class="conum">(3)</b>
    sources:
      market-service: <b class="conum">(4)</b>
          http: http://localhost:8081/command-executor/commands <b class="conum">(5)</b>
      shippement-service:
           http: http://localhost:8081/command-executor/commands
      pizza-shop:
           http: http://localhost:8081/command-executor/commands</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>this is the root of the kermoss properties, at this level you can explore all the properties to configure using the auto-completion of your IDE</p>
</li>
<li>
<p>the name of your microservice or application is used to improve the audit and the level of command tracking, if you omit this option the name of the application of your project will be taken into account.</p>
</li>
<li>
<p>possible values ​​are: kafka, feign, and http</p>
</li>
<li>
<p>the destination key configured at the command level</p>
</li>
<li>
<p>the target address to which kermoss will send the command based on the destination key</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_steps_to_master_kermoss">First steps to master Kermoss</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To concretely master the different concepts of kermoss we will refer to the pizzashop example, for more details on the source code of the pizzashop project see <a href="https://github.com/kermoss/kermoss/tree/master/saga-worker">here</a></p>
</div>
<div class="paragraph">
<p>The pizzashop project consists of three microservices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pizzashop: contains the logic for ordering pizza, cooking, and payment</p>
</li>
<li>
<p>pizzaship: contains the delivery logic</p>
</li>
<li>
<p>market: provides the necessary ingredients for a pizza</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_run_pizza_shop_microservices">How to run pizza shop microservices</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">git clone https://github.com/kermoss/kermoss.git
cd kermoss
mvn clean install <b class="conum">(1)</b>
cd saga-worker/target
java -jar saga-worker-${version}.jar --spring.profiles.active=dev,shop <b class="conum">(2)</b>
java -jar saga-worker-${version}.jar --spring.profiles.active=dev,ship <b class="conum">(3)</b>
java -jar saga-worker-${version}.jar --spring.profiles.active=dev,market <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This will build the whole project and include saga-worker which the maven module containing the source code for the pizza shop microservices</p>
</li>
<li>
<p>launch the pizzshop microservice in dev mode</p>
</li>
<li>
<p>launch the pizzaship microservice in dev mode</p>
</li>
<li>
<p>launche the microservice market in dev mode</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>Each microservice has its own configuration file you can find and modify it in the saga-worker / resources folder example application-market.yml is the configuration file for market microservice</em></p>
</div>
</div>
</div>
<div class="paragraph">
<p>If all goes well without error, this entry point <strong><a href="http://localhost:8081/pizza/test/order" class="bare">http://localhost:8081/pizza/test/order</a></strong> allows you to run the pizza order scenario.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_run_pizza_shop_as_single_monolith_application">How to run pizza shop as single monolith application</h2>
<div class="sectionbody">
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">java -jar saga-worker-${version}.jar --spring.profiles.active=dev,single <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>launch the pizzshop application in dev mode</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><em>application-single.yml est le fichier de configuration yaml pour pizza shop application</em></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bfm_pizzashop_together">BFM &amp; pizzashop together 🙏</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Kermoss by default uses communication in asynchronous mode even if the pizzaship service is not available it can continue while waiting for it to be up and running, but this does not prevent kermoss from also supporting synchronous communication in blocking mode, this will be illustrated in the scenario when pizzashop microservice requests the service market in blocking mode, if there is not enough ingredient or the service does not respond, the pizzashope service stops the global transaction</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The pizza shop microservice is the owner and initiator of the global transaction, so by default kermoss assigns it the role of the orchestrator of the entire distributed transaction cycle, all communication in the BFM (Business Flow Model) internally in pizza shop are driven by events, on the other hand communication with other microservices (market and pizza ship) are driven by commands</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>A BFM (Business Flow Model) is just a set of components in the form of a java class called <strong> workers </strong> (global and local transaction)</p>
</div>
<div class="ulist">
<div class="title">A BFM is made up of :</div>
<ul>
<li>
<p><strong> worker </strong> class that extends GlobalTransactionWorker allowing to start or close a global transaction by listening on events..</p>
</li>
<li>
<p><strong> worker </strong> class that extends LocalTransactionWorker allowing to start or close or rollback (compensate) a local transaction by listening on events.</p>
</li>
<li>
<p>Each <strong> worker </strong> communicate internally by events and can send commands to remote BFMs all this happens through a chain of operators <strong> TransactionStepDefinition </strong> these are in a way the equivalent of RouteBuilder in the camel project.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kermoss_project_organization">Kermoss : project organization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>it is better to have the following organization for your project, however you are free to choose a suitable structure for your project, the objective of this part is to show you the different components that you would need to develop your project with kermoss.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>📒 pizza-shop <b class="conum">(1)</b>
  📄 pom.xml
  📂 src/main/java
    📂 org.pizzasho <b class="conum">(2)</b>
      📂 api <b class="conum">(3)</b>
      📂 cmd <b class="conum">(4)</b>
      📂 decoder <b class="conum">(5)</b>
      📂 domain <b class="conum">(6)</b>
      📂 event <b class="conum">(7)</b>
      📂 exception <b class="conum">(8)</b>
      📂 service <b class="conum">(9)</b>
      📂 worker <b class="conum">(10)</b>
        📄 OrderPizzaStateWorker.java <b class="conum">(11)</b>
  📂 src/main/resources
    📄 application.yml <b class="conum">(12)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>your project root</p>
</li>
<li>
<p>your root package: the domain name</p>
</li>
<li>
<p>you can create your rest api here</p>
</li>
<li>
<p>package containing the commands to send to remote BFMs</p>
</li>
<li>
<p>package contains decoder services; when a command lands in a remote microservice, the decoder service creates an event based on the commands subject (a subject is only a key that allows the mapping with an event), for this purpose a given worker (global or local transaction) receives this command by listening on this event.</p>
</li>
<li>
<p>your domain business logic (model + repositories + services)</p>
</li>
<li>
<p>package containing the events for internal communication between the different workers (Global and Local transaction)</p>
</li>
<li>
<p>package containing exceptions</p>
</li>
<li>
<p>package containing the services of the application layer</p>
</li>
<li>
<p>package containing the BFM as a component, we recommend that worker adhere to the following convention: &lt;serviceName&gt;Worker.java</p>
</li>
<li>
<p>contains the configuration of kermoss as well as your application</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_your_first_globaltransaction_worker">Create your first globalTransaction worker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You just have to create a java class like OrderPizzaStateWorker.java (see the example of pizzashop) which extends GlobalTransactionWorker and annotate it with spring @Component annotation</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Component
public class OrderPizzaStateWorker extends GlobalTransactionWorker&lt;OrderPizzaReceivedEvent, OrderPizzaReadyEvent&gt; {

    public OrderPizzaStateWorker() {
        super(new WorkerMeta("OrderPizzaService")); <b class="conum">(1)</b>
    }

    @Override
    @BusinessGlobalTransactional <b class="conum">(2)</b>
    public GlobalTransactionStepDefinition onStart(OrderPizzaReceivedEvent orderPizzaReceivedEvent)  { <b class="conum">(3)</b>
        return GlobalTransactionStepDefinition.builder() <b class="conum">(4)</b>
                .in(orderPizzaReceivedEvent)<b class="conum">(5)</b>
                .meta(this.meta)<b class="conum">(6)</b>
                .process(Optional.empty())<b class="conum">(7)</b>
                .blow(Stream.of(new OrderPizzaReadyEvent(orderPizzaReceivedEvent.getCartId())))<b class="conum">(8)</b>
                .build();
    }

    @Override
    @CommitBusinessGlobalTransactional <b class="conum">(9)</b>
    public GlobalTransactionStepDefinition onComplete(OrderPizzaReadyEvent orderPizzaReadyEvent ) { <b class="conum">(10)</b>
        return GlobalTransactionStepDefinition.builder()
                .in(orderPizzaReadyEvent)
                .meta(this.meta)
                .process(Optional.empty())
                .build();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Worker Meta data, contains the unique name of the global Transaction, it allows to identify it, and to attach the different local transaction workers that must be subordinated by this transaction</p>
</li>
<li>
<p>Transaction Demarcation: start a new global transaction by listening to an event</p>
</li>
<li>
<p>listen on an event of type OrderPizzaReceivedEvent</p>
</li>
<li>
<p>Create a Global Transaction StepDefinition it is the equivalent of a route builder it allows to execute a command chain</p>
</li>
<li>
<p>allow the Global Transaction StepDefinition to consume the event</p>
</li>
<li>
<p>pass the meta data reference to the Global Transaction StepDefinition</p>
</li>
<li>
<p>you can put a side effect here</p>
</li>
<li>
<p>trigger an event stream</p>
</li>
<li>
<p>Transaction Demarcation: Commit and close Global Transaction by listening to an event</p>
</li>
<li>
<p>listen on an event of type orderPizzaReadyEvent</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_begin_a_new_global_transaction">Begin a new Global transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To be able to start a new global transaction, start an event with:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Autowired <b class="conum">(1)</b>
ApplicationEventPublisher applicationEventPublisher;

@Transactional <b class="conum">(2)</b>
    public void prepareOrder(Cart cart){
        orders.put(cart.getId(), cart);
        applicationEventPublisher.publishEvent(new OrderPizzaReceivedEvent(cart.getId()));<b class="conum">(3)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>inject a spring ApplicationEventPublisher to publish en event</p>
</li>
<li>
<p>decorate your method with the classic <strong> @ Transactional </strong> annotation from spring</p>
</li>
<li>
<p>publish your event to start the global transaction</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bind_a_global_transaction_context">Bind a global transaction context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Supposing that in some situation you want to launch an event from your business logic to call a worker (ex: play, commit, or rollback a localTransaction), in this case you need a way to attach the context of a global transaction, by persisting its id in your business model at this level you can communicate with your BFM, outside the context of the global transaction</p>
</div>
<div class="paragraph">
<p>Kermoss provides this feature by offering the attach method in the pipeline <strong> GlobalTransactionStepDefinition </strong> or <strong> LocalTransactionStepDefinition </strong> in this case you can bind a global transaction context either from GlobalTransaction worker, or LocalTransaction Worker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">       return GlobalTransactionStepDefinition.builder()
                ...
                .attach(gtx -&gt;orderSevice.saveGlobalTransactionId(gtx)) <b class="conum">(1)</b>
                .build();
    }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_call_your_bfm_workers_from_outside">Call your BFM workers from outside</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can call your BFM at all levels from your business logic by injecting the BusinessFlow component of the kermoss framework into your services then call the <strong> access </strong> method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Service
public class BakingService {

    @Autowired
    BusinessFlow businessFlow; <b class="conum">(1)</b>

    private static final Logger log = LoggerFactory.getLogger(BakingService.class);
    @Transactional <b class="conum">(2)</b>
    public void bake(String gtx, String cartid){
        businessFlow.access(gtx, new BakingPizzaReadyEvent(cartid));	<b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>inject a kermoss <strong> BusinessFlow </strong> service</p>
</li>
<li>
<p>wrap your business logic with the classic spring annoation <strong> @ Transactional </strong>, to ensure that your business logic is transactional including BFM</p>
</li>
<li>
<p>call the access method by injecting it with a global transaction id already persisted in your business model, then the second parameter used as event to commit the local transaction <strong> BakerPizzaServiceWorker </strong> in the pizzashop microservice</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_send_a_command_to_a_remote_bfm">Send a command To a remote BFM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sending a command to a remote BFM is quite simple with kermoss, just create a class that extends BaseTransactionCommand and choose a convinient string <strong><em>subject</em></strong> which would later be used by the remote BFM&#8217;s decoder service to create an event (kermoss will publish this event to the various subscribers in the BFM in order to receive this command). The second important argument is  <strong><em>destination</em></strong> key parameter that you will then map it with an target address (HTTP, or a Kafka topic) depending on the transport layer of your preference.</p>
</div>
<div class="paragraph">
<p>Finally you can call the <strong> send </strong> operator of the <strong> TransactionStepDefinition </strong> pipeline allowing to send a command stream either from a global or a local transaction.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
    @SwitchBusinessLocalTransactional
    public LocalTransactionStepDefinition onNext(BoxDeliverFinishedEvent onNextEvent) {
       String invoiceRef="5b6a668c-152a-44b4-8fbd-8819bc63aebb";
    	PayBillCommand cmd = new PayBillCommand("pay-delivery-service", "",new Bill(1, invoiceRef)
                , "pizza-shop"); <b class="conum">(1)</b>
        return LocalTransactionStepDefinition.builder()
                .in(onNextEvent)
                .blow(Stream.of(new BoxDelivredEvent()))<b class="conum">(2)</b>
                .meta(this.meta)
                .send(Stream.of(cmd)) <b class="conum">(3)</b>
                .build();
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>pizzaship microservice configure the PayBillCommand command with the <strong>destination</strong> key <strong>pizza-shop</strong> to send it to the pizzashop microservice &amp; <strong> subject </strong> key <strong>"pay-delivery-service"</strong> to trigger an event by the decoder service of the remote BFM</p>
</li>
<li>
<p>triggers the BoxDelivredEvent</p>
</li>
<li>
<p>the operator <strong>send(Stream.of(cmd))</strong> is used to send the PayBillCommand command</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_map_a_commands_subject_with_a_target_address">Map a command&#8217;s subject with a target address</h3>
<div class="paragraph">
<p>Kermoss routes the commands to the remote BFMs based on their destination key, the destination key must be mapped with an address (HTTP or service name in consul or eurika registry services, kafka topic) in your configuration file.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kermoss:
  service-name: pizza-shop
  transport:
    default-layer: http <b class="conum">(1)</b>
  sources:
    shippement-service: <b class="conum">(2)</b>
      feign: shippement-service <b class="conum">(3)</b>
      http: "http://localhost:8083/command-executor/command" <b class="conum">(4)</b>
      kafka: io.kermoss.topics.pizzashop.shippementservice <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>choose your suitable transport layer; the possible values ​​are: kafka for the kafka broker, or if you prefer the HTTP transport layer, use feign or http</p>
</li>
<li>
<p>this is the subject key of the commad to map to a target address</p>
</li>
<li>
<p>if the <strong> feign </strong> option is chosen as a value for the <strong> transport.default-layer </strong> property, the <strong> "shippement-service" </strong> value of the <strong> feign </strong> key should match the service name of the microservice (pizza ship) in your service catalog (eurika, consul)</p>
</li>
<li>
<p>use the "http" key mapped to an http address of the "pizza ship" microservice if only if the <strong> http </strong> option is chosen as a value for the <strong> transport.default-layer </strong> property, the following path "/ command-executor / command" must be included in your http url</p>
</li>
<li>
<p>the value of the kafka key matches the name of the kafka topic if only if the <strong> kafka </strong> option is configured as a value for the <strong> transport.default-layer </strong> property.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="ulist">
<div class="title">transport.default-layer property:</div>
<ul>
<li>
<p>We recommend that you adopt the feign option if your choice of transport layer will be HTTP and you later want to deploy your microservice with kermoss in a production environment.</p>
</li>
<li>
<p>Use http option in your test or development environment, or if you do not have a registry service</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_receive_a_command_from_a_remote_bfm">Receive a command from a remote BFM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>if you have opted for kafka to be the default transport layer for your project, in this case it will be necessary to add this following configuration part in your yaml or properties file:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kermoss:
  service-name: pizza-shop
  transport:
    default-layer: kafka
  sinks: <b class="conum">(1)</b>
    pizza-shop:
      kafka: io.kermoss.topics.pizzashop <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>sinks: wraps all the possible topics to consume, as a source of commands for your BFM</p>
</li>
<li>
<p>tells kermoss if you have chosen the kafka value for the transport.default-layer property to consume the commands coming from the topic <strong> io.kermoss.topics.pizzashop </strong></p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>As already explained previously, when a command lands on your microservice, it is necessary to trigger an event indicating to the BFM that there is a new command waiting in the pool to be consumed by workers that subscribe to this event.
to carry out this operation you should create a decoder service allowing to produce this event.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DeliverPizzaDecoder implements BaseDecoder {

    @Override
    public BaseTransactionEvent decode(CommandMeta meta) { <b class="conum">(1)</b>
        BoxArrivedEvent deliverPizzaStartedEvent = new BoxArrivedEvent();<b class="conum">(2)</b>
        return deliverPizzaStartedEvent;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>contains the mata data on the command</p>
</li>
<li>
<p>produce an event and then drop it off by kermoss on an event bus, so workers who subscribe to this type of event can consume the command</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_configure_the_decoder_service">How to configure the decoder service</h3>
<div class="paragraph">
<p>So that your <strong> decoder service </strong> is able to produce an event when a command arrives, it is necessary to register it and map it with the subject of the command in a dedicated component for the configuration, see the code java below .</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Configuration
public class DecoderConfiguration extends DecoderRegistry { <b class="conum">(1)</b>

    @PostConstruct
    public void setup() {
        DeliverPizzaDecoder decoder1 = new DeliverPizzaDecoder();
        this.put("deliver-pizza", decoder1); <b class="conum">(2)</b>

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>here you can put all the mapping of your decoder services in your microservice</p>
</li>
<li>
<p>"deliver-pizza" subject mapping with the DeliverPizzaDecoder</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commands_consumption">Commands consumption</h3>
<div class="paragraph">
<p>In the end, the command becomes visible and ready to be consumed by all the workers of your BFM who are subscribed to the BoxArrivedEvent event</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DeliverBoxWorker extends GlobalTransactionWorker&lt;BoxArrivedEvent, BoxDelivredEvent&gt; {
 @Override
    @BusinessGlobalTransactional
    public GlobalTransactionStepDefinition onStart(BoxArrivedEvent boxArrivedEvent){ <b class="conum">(1)</b>
        return GlobalTransactionStepDefinition.builder()
                .in(boxArrivedEvent)
                .meta(this.meta)
                .receive(ToDilever.class, x -&gt; System.out.println(x.toString())) <b class="conum">(2)</b>
                .build();
    }
 ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>subscribe to the <strong> boxArrivedEvent </strong> event produced by the decoder Service <strong> DeliverPizzaDecoder </strong></p>
</li>
<li>
<p>consumption of the command : ToDilever</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enlist_a_local_transaction_worker">Enlist a Local Transaction Worker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>the creation and the enrollment of a local transaction is very similar to a global transaction, indeed to create a local transaction it is enough just to extend the class <strong> LocalTransactionWorker </strong> and to annotate it with @component so that it is supported by kermoss, we can take as an example the ChefCookingServiceWorker.java class in the pizzashop microservice.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package io.kermoss.saga.pizzashop.worker;

@Component
public class ChefCookingServiceWorker
		extends LocalTransactionWorker&lt;OrderPizzaPendingEvent, OrderPizzaCookedEvent, ErrorLocalOccured&gt; {

	@Autowired
	PizzaService pizzaService;

	public ChefCookingServiceWorker() {
		super(new WorkerMeta("MakingPizza", "OrderPizzaService"));<b class="conum">(1)</b>
	}

	@Override
	@BusinessLocalTransactional <b class="conum">(2)</b>
	public LocalTransactionStepDefinition onStart(OrderPizzaPendingEvent orderPizzaPendingEvent) { <b class="conum">(3)</b>
		return LocalTransactionStepDefinition.builder().in(orderPizzaPendingEvent)<b class="conum">(4)</b>
				.blow(Stream.of(new BakingPizzaPendingEvent(orderPizzaPendingEvent.getCartID()))).meta(this.meta) <b class="conum">(5)</b>
				.build();
	}

	@Override
	@SwitchBusinessLocalTransactional <b class="conum">(6)</b>
	public LocalTransactionStepDefinition onNext(OrderPizzaCookedEvent orderPizzaCookedEvent) {

		OrderPizzaReadyForShipmentCommand cmd = null;
		if (pizzaService != null) {

			ToDilever b = new ToDilever("Some address", pizzaService.getOrders().get(orderPizzaCookedEvent.getCartId())
					.getPizzas().stream().map(Pizza::getName).collect(Collectors.toList()));
			cmd = new OrderPizzaReadyForShipmentCommand("deliver-pizza", "", b, "shippement-service");
		}
		return LocalTransactionStepDefinition.builder().in(orderPizzaCookedEvent)
				.blow(Stream.of(new OrderPizzaReadyEvent(orderPizzaCookedEvent.getCartId()))).<b class="conum">(7)</b>
				send(Stream.of(cmd)) <b class="conum">(8)</b>
				.meta(this.meta).build();
	}

	@Override
	@RollBackBusinessLocalTransactional <b class="conum">(9)</b>
	public LocalTransactionStepDefinition onError(ErrorLocalOccured errorLocalOccured) { <b class="conum">(10)</b>
		return LocalTransactionStepDefinition.builder().in(errorLocalOccured).meta(this.meta).build();
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>worker Meta data, contains the unique name <strong>MakingPizza</strong> of the local Transaction, it allows to identify it, also it allows to register it in the global transaction "OrderPizzaService"</p>
</li>
<li>
<p>Transaction demarcation: start a new local transaction by listening to an event</p>
</li>
<li>
<p>listen on an event of type OrderPizzaPendingEvent</p>
</li>
<li>
<p>allow the Local Transaction StepDefinition to consume the event</p>
</li>
<li>
<p>pass the meta data reference to the local Transaction StepDefinition</p>
</li>
<li>
<p>transaction demarcation: Commit and close Local Transaction by listening to an event</p>
</li>
<li>
<p>trigger an event stream</p>
</li>
<li>
<p>send a command stream</p>
</li>
<li>
<p>transaction demarcation: rollBack a Business LocalTransaction by listening to an event of type ErrorLocalOccured</p>
</li>
<li>
<p>listen on an event of type ErrorLocalOccured</p>
</li>
</ol>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>a local transaction can monitor one or more local transactions</p>
</li>
<li>
<p>a local transaction can only be registered to a single local transaction or global transaction through the metaWorker</p>
</li>
<li>
<p>a local transaction cannot be committed, only if all of its children are committed</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compensating_transaction_rollback">Compensating transaction (rollback)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>the rollback phase of a business transaction begins when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if one of the BFM workers fire an exception.</p>
</li>
<li>
<p>one or more workers define a rollback policy by catching this exception:</p>
<div class="ulist">
<ul>
<li>
<p>a rollback policy consists of mapping this exception to an event.</p>
</li>
<li>
<p>a rollback policy can define a global or local compensation scope</p>
</li>
<li>
<p>if the scope of compensation is global, the Orchestrator (realm manager) of the global transaction sends a message to all members (ambassadors), to stop worker transactions and only accept compensation commands or execute methods annotated with @RollBackBusinessLocalTransactional</p>
</li>
<li>
<p>if the scope of compensation is local, a global transaction may have another chance to recover.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Override
	@BusinessLocalTransactional
	public LocalTransactionStepDefinition onStart(DeliveryBillArrivedEvent deliveryBillArrivedEvent) {
		return LocalTransactionStepDefinition.builder().in(deliveryBillArrivedEvent)
				.blow(Stream.of(new DeliveryBillPayed())).receive(Bill.class, x -&gt; {  <b class="conum">(1)</b>
					System.out.println(x.toString());
					if (x.getPrice() &gt; 2) {
                     throw new ExpensiveException("pizza is too much expensive");  <b class="conum">(2)</b>
					}
				})
				 .compensateWhen(Propagation.GLOBAL,Stream.of(new PizzaRejectedEvent ()),DelayException.class, ExpensiveException.class) <b class="conum">(3)</b>
				.receive(Bill.class, (x, y) -&gt; log.info("linking object {} with gtx {}", y, x)).meta(this.meta).build();

	}

	@Override
	@RollBackBusinessLocalTransactional

	public LocalTransactionStepDefinition onError(PizzaRejectedEvent pizzaRejectedEvent) { <b class="conum">(4)</b>
		return LocalTransactionStepDefinition.builder().in(pizzaRejectedEvent).meta(this.meta).build();
	}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>receives a command of type Bill.java</p>
</li>
<li>
<p>under certain conditions you can raise an exception</p>
</li>
<li>
<p>defines rollback policy which consists of mapping one or more exceptions to an event stream and indicating the scope of propagation.</p>
</li>
<li>
<p>start a rollback pipeline by listening on the PizzaRejectedEvent</p>
</li>
</ol>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Not all exceptions raised within your application are captured by kermoss to start a rollback (compensating a business transaction).</p>
</li>
<li>
<p>it must be triggered from a pipeline <strong> LocalTransactionStepDefinition </strong> or <strong> GlobalTransactionStepDefinition </strong></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="ulist">
<div class="title">Best practice</div>
<ul>
<li>
<p>always remember to create a service that you can inject into your BFM worker (Global or local), then call the method of this service containing the logic that raises an exception from the pipeline operators <strong> LocalTransactionStepDefinition </strong> or <strong> GlobalTransactionStepDefinition </strong></p>
</li>
<li>
<p>in general the two operators recieve and process are sufficient to wrap the logic of an exception</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-03-23 22:25:11 +0100
</div>
</div>
</body>
</html>